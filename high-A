#!/bin/sh

while getopts m:r:n: myflag ; do
    case "$myflag" in
    m)
        markus=$OPTARG
    ;;
    r)
        ro=$OPTARG
    ;;
    n)
        n="$OPTARG"
    ;;
    *)
    ;;
    esac
done

# markus file
# sort by utorid
# join both files by utorid
sorted_ro=$(sort -t',' -k2,2 "$ro")
student_grades="$(echo "$sorted_ro" | join -t',' -1 2 -2 1 -a 1 -a 2 - "$markus")"
student_grades="$(echo "$student_grades" | sort -t',' -n -r -k4 -)"
students_with_grades="$(echo "$student_grades" | grep -E '^[^,]+,[^,]+,[^,]+,[0-9]+$' - | cut -d ',' -f 3-4)"

# ro file
# sort roster by student id
# join both files by student id
# sorted_ro=$(sort -t',' -k1,1 "$ro")
# student_grades="$(echo "$sorted_ro" | join -t',' -1 1 -2 1 -a 1 -a 2 - "$markus")"
# student_grades="$(echo "$student_grades" | sort -t',' -n -r -k4 -)"
# students_with_grades="$(echo "$student_grades" | grep -E '^[^,]+,[^,]+,[^,]+,[0-9]+$' - | cut -d ',' -f 3-4)"

echo "$(echo "$students_with_grades" | head -n "$n" -)"

# part b: use process substitution but on join